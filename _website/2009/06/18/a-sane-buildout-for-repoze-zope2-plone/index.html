<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>A Sane Buildout For repoze.zope2 + Plone &mdash; Alex Clark&#39;s Blog</title>
    
    <link rel="stylesheet" href="../../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootswatch-3.3.4/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="top" title="Alex Clark&#39;s Blog" href="../../../../" />
  
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
  <link rel="alternate" type="application/atom+xml"  href="../../../../blog/atom.xml" title="Alex Clark's Blog">
  
  
  <link href="True" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../">
          Alex Clark&#39;s Blog</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="http://aclark.net">Home</a></li>
                <li><a href="https://www.facebook.com/aclark4life">Facebook</a></li>
                <li><a href="https://github.com/aclark4life">GitHub</a></li>
                <li><a href="https://gratipay.com/aclark4life">Gratipay</a></li>
                <li><a href="https://www.linkedin.com/in/aclark4life">LinkedIn</a></li>
                <li><a href="https://twitter.com/aclark4life">Twitter</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../now/">What I&#8217;m doing now</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../feeds/">Feeds</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../search/" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    Jun 18, 2009
  
  </h2>

  <ul>
    

  

  

  

  
  <li><i class="fa-fw fa fa-folder-open"></i>
    
      
      <a href="../../../../blog/category/buildout/">Buildout</a>,
      
    
      
      <a href="../../../../blog/category/plone/">Plone</a>,
      
    
      
      <a href="../../../../blog/category/python/">Python</a>,
      
    
      
      <a href="../../../../blog/category/zope/">Zope</a>
      
    </li>
  

  
  
  <li>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'aclark-blog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/2009/06/18/a-sane-buildout-for-repoze-zope2-plone/index/"> </a>
  </li>
  
  </ul>



  <h3><a href="../../../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../../../2016/11/23/project-makefile-open-business/">Nov 23 - Project Makefile Open for Business</a></li>
    
      <li><a href="../../../../2016/04/03/yup-this-blog-is-now-powered-by-ablog/">Apr 03 - Yup, this blog is now powered by ABlog</a></li>
    
      <li><a href="../../../../2016/02/21/updated-django-website/">Feb 21 - Updated Django Website</a></li>
    
      <li><a href="../../../../2015/10/10/plock-0-5-0-is-out/">Oct 10 - Plock 0-5-0 is out</a></li>
    
      <li><a href="../../../../2015/10/07/dc-python-jobs/">Oct 07 - DC Python Jobs</a></li>
    
  </ul>

  <h3><a href="../../../../blog/category/">Categories</a></h3>
  <ul>
  
    
    <li><a href="../../../../blog/category/buildout/">Buildout (33)</a></li>
    
  
    
    <li><a href="../../../../blog/category/django/">Django (5)</a></li>
    
  
    
    <li><a href="../../../../blog/category/misc/">Misc (22)</a></li>
    
  
    
    <li><a href="../../../../blog/category/mozilla/">Mozilla (2)</a></li>
    
  
    
    <li><a href="../../../../blog/category/music/">Music (1)</a></li>
    
  
    
    <li><a href="../../../../blog/category/pillow/">Pillow (16)</a></li>
    
  
    
    <li><a href="../../../../blog/category/plone/">Plone (79)</a></li>
    
  
    
    <li><a href="../../../../blog/category/pyramid/">Pyramid (6)</a></li>
    
  
    
    <li><a href="../../../../blog/category/python/">Python (62)</a></li>
    
  
    
    <li><a href="../../../../blog/category/zope/">Zope (6)</a></li>
    
  
  </ul>

  <h3><a href="../../../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../../../blog/2016/">2016 (3)</a></li>
    
  
    
    <li><a href="../../../../blog/2015/">2015 (13)</a></li>
    
  
    
    <li><a href="../../../../blog/2014/">2014 (11)</a></li>
    
  
    
    <li><a href="../../../../blog/2013/">2013 (21)</a></li>
    
  
    
    <li><a href="../../../../blog/2012/">2012 (35)</a></li>
    
  
    
    <li><a href="../../../../blog/2011/">2011 (26)</a></li>
    
  
    
    <li><a href="../../../../blog/2010/">2010 (9)</a></li>
    
  
    
    <li><a href="../../../../blog/2009/">2009 (7)</a></li>
    
  
    
    <li><a href="../../../../blog/2008/">2008 (19)</a></li>
    
  
    
    <li><a href="../../../../blog/2007/">2007 (8)</a></li>
    
  
  </ul>

<form action="../../../../search/" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="a-sane-buildout-for-repoze-zope2-plone">
<h1>A Sane Buildout For repoze.zope2 + Plone<a class="headerlink" href="#a-sane-buildout-for-repoze-zope2-plone" title="Permalink to this headline">¶</a></h1>
<p><strong>This is a follow-up to Martin Aspeli&#8217;s introduction to repoze and Plone from last year</strong></p>
<div class="section" id="a-tale-of-two-buildouts">
<h2>A Tale of Two Buildouts<a class="headerlink" href="#a-tale-of-two-buildouts" title="Permalink to this headline">¶</a></h2>
<p>There are two stories going on here, both of which <a class="reference external" href="http://www.martinaspeli.net/articles/scrambled-eggs">Martin Aspeli recently described in great detail</a> and <a class="reference external" href="http://plope.com/Members/chrism/distribution_links_considered_harmful">Chris McDonough tackled last year</a>. For the purposes of this blog entry, I&#8217;ll refer to the issue as the &#8220;index vs. find-links&#8221; conundrum in buildout&nbsp; (find-links in buildout are equivalent to distribution_links in setuptools).</p>
<p>For those that want strict repeatability, using the index parameter is the clear winner. It simply forces buildout to do the right thing now and forever, by limiting what packages it can select from. For those that want functionality and don&#8217;t mind the occasional egg-out-of-whack (i.e. unexpected upgrade), then using the find-links parameter can provide a &#8220;sexy&#8221; way to get decent results quickly (but may, and probably will, shoot you in the foot later).</p>
</div>
<div class="section" id="sexy-but-dangerous">
<h2>Sexy, but Dangerous<a class="headerlink" href="#sexy-but-dangerous" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s start with the sexy, but with less repeat-ability method first.  Using this method we are not specifying our own index. Therefore you are free to add any package from <a class="reference external" href="http://pypi.python.org/simple/">PyPI</a> or <a class="reference external" href="http://plone.org/products/simple">plone.org</a> as you see fit.  This is essentially why people like this method (the counter argument is that it is simple to add any additional egg you may want to your index, but we&#8217;ll get to that later).</p>
<p>So a simple buildout using this method might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>virtualenv plone; cd plone
bin/easy\_install zc.buildout
bin/buildout init
Edit buildout.cfg:
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>[buildout]
extends =
# Using Martin Aspeli&#39;s good-py, thanks!
    http://good-py.appspot.com/release/repoze.zope2/1.0
    http://dist.plone.org/release/3.3rc3/versions.cfg
versions = versions
find-links =
    http://dist.repoze.org/zope2/latest
    http://dist.repoze.org/zope2/dev/
    http://dist.plone.org/release/3.3rc3
parts = instance[instance]
recipe = zc.recipe.egg
dependent-scripts = true
eggs =
    repoze.zope2
    Plone
    PIL

4. bin/buildout
</pre></div>
</div>
<p>A few more steps are required, which we could certainly automate in
buildout, but for now I&#8217;ll just list them here:</p>
<blockquote>
<div><ol class="arabic simple" start="5">
<li>bin/mkzopeinstance</li>
<li>bin/addzope2user admin admin</li>
</ol>
</div></blockquote>
<p>Now, the moment we&#8217;ve all been waiting for… the fun part!</p>
<blockquote>
<div><ol class="arabic simple" start="7">
<li>bin/paster serve etc/zope2.ini</li>
</ol>
</div></blockquote>
<p>You should see something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[aclark@alex-clarks-macbook-pro]~/Developer/plone% bin/paster serve etc/zope2.ini
2009-06-18 22:52:24 INFO Marshall libxml2-python not available. Unable to register libxml2 based marshallers.
2009-06-18 22:52:27 WARNING ZODB.FileStorage Ignoring index for
/Users/aclark/Developer/p3-repoze-2/var/Data.fsDeprecationWarning: zope.app.annotation has moved to
zope.annotation. Import of zope.app.annotation will become
unsupported in Zope 3.5
/Users/aclark/Developer/plone/eggs/zopelib-2.10.7.0-py2.4-macosx-10.5-i386.egg/zope/configuration/xmlconfig.py:323:
  __import__(arguments[0])
------
2009-06-18T22:52:24 INFO Marshall libxml2-python not available. Unable to register libxml2 based marshallers.
------
2009-06-18T22:52:27 WARNING ZODB.FileStorage Ignoring index for /Users/aclark/Developer/plone/var/Data.fs
Starting server in PID 26900.
zserver on port 8080
</pre></div>
</div>
<p>At this point, you should be able to login to
<a class="reference external" href="http://localhost:8080/manage">http://localhost:8080/manage</a> and create a Plone site.</p>
<p>Of course, we did a sloppy job here, creating the Zope2 instance in the
root of the buildout, etc. It is possible that
<a class="reference external" href="http://pypi.python.org/pypi/plone.recipe.zope2instance/3.2">plone.recipe.zope2install</a> may help us in the future by supporting
repoze.zope2 instances (or maybe it does already, I didn&#8217;t try).</p>
<p>Next up?</p>
</div>
<div class="section" id="boring-but-repeatable">
<h2>Boring, but Repeatable<a class="headerlink" href="#boring-but-repeatable" title="Permalink to this headline">¶</a></h2>
<p>I kid, but this is actually a very serious concern for many people, and
rightfully so. The notion that your buildout will work the same today as
it does in one year from now may be a strict requirement for your
project. If it is, we can accommodate you (I hope) with the &#8220;index&#8221;
buildout that follows. The downside is that *you* can&#8217;t control what I
put in the index. However, you can certainly create your own index using
this technique.</p>
<p>An arguably even simpler buildout using this technique might look like
this:</p>
<blockquote>
<div><ol class="arabic simple" start="0">
<li>virtualenv plone; cd plone</li>
<li>bin/easy_install zc.buildout</li>
<li>bin/buildout init</li>
<li>Edit buildout.cfg:</li>
</ol>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span></span>[buildout]
index = http://dist.plone.org/experimental/release/3.3rc3/simple/
parts = instance[instance]
recipe = zc.recipe.egg
dependent-scripts = true
eggs =
    repoze.zope2
    Plone
    PIL

4. bin/buildout

5. bin/mkzopeinstance

6. bin/addzope2user admin admin

7. bin/paster serve etc/zope2.ini
</pre></div>
</div>
</div>
<div class="section" id="in-conclusion">
<h2>In Conclusion<a class="headerlink" href="#in-conclusion" title="Permalink to this headline">¶</a></h2>
<p>Depending on what my needs are, I might choose either of these
techniques. We can also hold out for <a class="reference external" href="http://bugs.python.org/setuptools/issue32">multi-index support in
setuptools</a>. That would seemingly make everyone happy. In the meantime,
I can tell you I&#8217;d definitely reach for a buildout sans custom index
first, then ask questions later (i.e. wait for bleeding toes) but that
is just me. If people find the &#8220;index&#8221; technique generally useful, I&#8217;d
be willing to support package sheperding and <a class="reference external" href="http://pypi.python.org/pypi/basketweaver/0.1.2-r6">index generating with
basketweaver</a>. Just let me know. If it really catches on, we could
rename <a class="reference external" href="http://dist.plone.org/experimental/release/3.3rc3/">http://dist.plone.org/experimental/release/3.3rc3/</a> to
<a class="reference external" href="http://dist.plone.org/repoze/release/3.3rc3/">http://dist.plone.org/repoze/release/3.3rc3/</a>. Of course, if anyone
objects to this or finds it confusing, I can just as easily remove it
(from dist.plone.org).</p>
<p>Special thanks to <a class="reference external" href="http://plope.com/">Chris McDonough</a> and <a class="reference external" href="http://www.martinaspeli.net/">Martin Aspeli</a> for helping me
scratch my itch!</p>
<p>Finally, please don&#8217;t rely on any of this &#8220;in production&#8221; yet unless you
know what you are doing. I tested these techniques up to the point of
starting Zope (via paste) and adding a Plone site, nothing more!</p>
<p>I, however, am getting a new server next week and will be hosting this
site on <a class="reference external" href="http://repoze.org/quickstart.html#repoze.zope2">repoze.zope2</a> very shortly ;-)</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../../../04/21/a-lamp-buildout-for-wordpress-and-other-php-apps/">
    <i class="fa fa-arrow-circle-left"></i>
    A LAMP Buildout for Wordpress and Other PHP Apps
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../../../09/22/review-of-veda-williams-plone-3-theming/">
    Review of Veda Williams' Plone 3 Theming
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'aclark-blog';
        var disqus_identifier = '/2009/06/18/a-sane-buildout-for-repoze-zope2-plone/';
        var disqus_title = 'A Sane Buildout For repoze.zope2 + Plone';
        var disqus_url = 'http://blog.aclark.net/2009/06/18/a-sane-buildout-for-repoze-zope2-plone/';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016, Alex Clark.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>