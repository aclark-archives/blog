<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Vagrant, Puppet and Mozilla, Oh my &mdash; Alex Clark&#39;s Blog</title>
    
    <link rel="stylesheet" href="../../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootswatch-3.3.4/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="top" title="Alex Clark&#39;s Blog" href="../../../../" />
  
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
  <link rel="alternate" type="application/atom+xml"  href="../../../../blog/atom.xml" title="Alex Clark's Blog">
  
  
  <link href="True" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../">
          Alex Clark&#39;s Blog</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="http://aclark.net">Home</a></li>
                <li><a href="https://www.facebook.com/aclark4life">Facebook</a></li>
                <li><a href="https://github.com/aclark4life">GitHub</a></li>
                <li><a href="https://gratipay.com/aclark4life">Gratipay</a></li>
                <li><a href="https://www.linkedin.com/in/aclark4life">LinkedIn</a></li>
                <li><a href="https://twitter.com/aclark4life">Twitter</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../now/">What I&#8217;m doing now</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../feeds/">Feeds</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../search/" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    Oct 03, 2011
  
  </h2>

  <ul>
    

  

  

  

  
  <li><i class="fa-fw fa fa-folder-open"></i>
    
      
      <a href="../../../../blog/category/mozilla/">Mozilla</a>,
      
    
      
      <a href="../../../../blog/category/python/">Python</a>
      
    </li>
  

  
  
  <li>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'aclark-blog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/2011/10/03/vagrant-puppet-and-mozilla-oh-my/index/"> </a>
  </li>
  
  </ul>



  <h3><a href="../../../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../../../2016/11/23/project-makefile-open-business/">Nov 23 - Project Makefile Open for Business</a></li>
    
      <li><a href="../../../../2016/04/03/yup-this-blog-is-now-powered-by-ablog/">Apr 03 - Yup, this blog is now powered by ABlog</a></li>
    
      <li><a href="../../../../2016/02/21/updated-django-website/">Feb 21 - Updated Django Website</a></li>
    
      <li><a href="../../../../2015/10/10/plock-0-5-0-is-out/">Oct 10 - Plock 0-5-0 is out</a></li>
    
      <li><a href="../../../../2015/10/07/dc-python-jobs/">Oct 07 - DC Python Jobs</a></li>
    
  </ul>

  <h3><a href="../../../../blog/category/">Categories</a></h3>
  <ul>
  
    
    <li><a href="../../../../blog/category/buildout/">Buildout (33)</a></li>
    
  
    
    <li><a href="../../../../blog/category/django/">Django (5)</a></li>
    
  
    
    <li><a href="../../../../blog/category/misc/">Misc (22)</a></li>
    
  
    
    <li><a href="../../../../blog/category/mozilla/">Mozilla (2)</a></li>
    
  
    
    <li><a href="../../../../blog/category/music/">Music (1)</a></li>
    
  
    
    <li><a href="../../../../blog/category/pillow/">Pillow (16)</a></li>
    
  
    
    <li><a href="../../../../blog/category/plone/">Plone (79)</a></li>
    
  
    
    <li><a href="../../../../blog/category/pyramid/">Pyramid (6)</a></li>
    
  
    
    <li><a href="../../../../blog/category/python/">Python (62)</a></li>
    
  
    
    <li><a href="../../../../blog/category/zope/">Zope (6)</a></li>
    
  
  </ul>

  <h3><a href="../../../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../../../blog/2016/">2016 (3)</a></li>
    
  
    
    <li><a href="../../../../blog/2015/">2015 (13)</a></li>
    
  
    
    <li><a href="../../../../blog/2014/">2014 (11)</a></li>
    
  
    
    <li><a href="../../../../blog/2013/">2013 (21)</a></li>
    
  
    
    <li><a href="../../../../blog/2012/">2012 (35)</a></li>
    
  
    
    <li><a href="../../../../blog/2011/">2011 (26)</a></li>
    
  
    
    <li><a href="../../../../blog/2010/">2010 (9)</a></li>
    
  
    
    <li><a href="../../../../blog/2009/">2009 (7)</a></li>
    
  
    
    <li><a href="../../../../blog/2008/">2008 (19)</a></li>
    
  
    
    <li><a href="../../../../blog/2007/">2007 (8)</a></li>
    
  
  </ul>

<form action="../../../../search/" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="vagrant-puppet-and-mozilla-oh-my">
<h1>Vagrant, Puppet and Mozilla, Oh my<a class="headerlink" href="#vagrant-puppet-and-mozilla-oh-my" title="Permalink to this headline">¶</a></h1>
<p><strong>This post is only loosely Python related and not at all Plone related.</strong></p>
<p>This post is only loosely Python related and not at all Plone related, but I thought folks might enjoy hearing about Vagrant and Puppet because these tools may help you do your Plone and Python jobs better.</p>
<p>For the past couple weeks I&#8217;ve been working on creating a virtual machine to bootstrap a kitsune environment. Kitsune is the Django site that powers support.mozilla.com. I&#8217;ve now reached what I call the <strong>2nd milestone</strong>.</p>
<div class="section" id="milestones">
<h2>Milestones<a class="headerlink" href="#milestones" title="Permalink to this headline">¶</a></h2>
<p>The milestones are as follows:</p>
<ol class="arabic simple">
<li>Get the VM running to the point where one can type <strong>./manage.py</strong> and receive the help output (and not a traceback). This sounds trivial but there is actually a lot of work involved to get to this point. Namely, figuring out how to make <a class="reference external" href="http://puppetlabs.com/">Puppet</a> execute each of the required steps successfully, together. (You would expect to be able to just define the steps in order, but those with this expectation will be disappointed. I assume Puppet has their reasons, and they are probably even good ones.)</li>
<li><strong>Get the VM running to the point where one can open http://33.33.33.10:8000 from the host to see kitsune running. Once step #1 is done, this is actually easier than it sounds because I&#8217;m &#8220;cheating&#8221;. Test data has been imported and a syncdb has been run, but I&#8217;m using supervisor to manage the runserver process (for now).</strong></li>
<li>Get the VM running like it does in production. This will involve configuring <strong>Apache</strong>and <strong>mod_wsgi</strong> as well as resolving any issues that remain with the app. I&#8217;ll rely on the kitsune team to help with this, as I&#8217;m still learning the app. This is the &#8220;exciting&#8221; part for me because I get to learn something new. While Vagrant and Puppet are also new to me, I consider these technologies part of my &#8220;past life&#8221; (as a system administrator) and Django sites part of my &#8220;future life&#8221; (as a web developer).</li>
</ol>
<p>Now about the technologies.</p>
</div>
<div class="section" id="vagrant">
<h2>Vagrant<a class="headerlink" href="#vagrant" title="Permalink to this headline">¶</a></h2>
<p>I had heard of <a class="reference external" href="http://vagrantup.com/">Vagrant</a> before, but never tried it. I am now sorry I waited so long because the &#8220;cool factor&#8221; is very high. It requires that <a class="reference external" href="https://www.virtualbox.org/">Virtualbox</a> be installed, which I also danced around for too long before committing (being a former Parallels user).</p>
<p>On OS X Lion[1], installing Vagrant is simply a matter of:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ gem install vagrant
</pre></div>
</div>
<p>Once you have `vagrant` installed you can do:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ vagrant init
</pre></div>
</div>
<p>inside some revision-controlled directory and you have the beginnings of a virtual machine you can share with the masses. This is how <a class="reference external" href="https://github.com/aclark4life/kitsune-vagrant">kitsune-vagrant</a> was born. Hopefully this shared virtual machine will eventually make some new developer&#8217;s life much easier.</p>
<p>We now arrive at a fork in the road; though Vagrant makes it easy to follow both paths: Chef or Puppet (it supports both). I don&#8217;t recall what made me choose Puppet over Chef, but it might have been that the <a class="reference external" href="https://github.com/rhelmer/socorro-vagrant">Socorro folks were using it already</a>.</p>
<p>Once you decide on Puppet (and assuming you do), it&#8217;s pretty easy to figure out that your next move is to create a manifest file for Puppet to apply[2].</p>
</div>
<div class="section" id="puppet">
<h2>Puppet<a class="headerlink" href="#puppet" title="Permalink to this headline">¶</a></h2>
<p>My knowledge of Puppet is currently quite limited. Specifically, I only know how to create a manifest file. (Vagrant does the rest!) I imagine there is much more to Puppet, especially with regard to doing actual configuration management on production servers. But I have not explored any of that yet.</p>
<p>However, I did learn quite a bit about Puppet just from writing the manifest. The first most important thing I learned is this: <strong>Puppet is in charge</strong>. It does things the way it wants to and you need to follow its rules. The first and biggest challenge is to achieve a linear execution of tasks.</p>
<p>You cannot write rules in order and hope for the best. This will fail spectacularly when something executes before something else was supposed to. The way around this is via `require =&gt;` statements.</p>
<p>A grep through kitsune.pp reveals:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>require =&gt; Exec[&#39;git_clone&#39;],
require =&gt; Exec[&#39;db_sync&#39;],
require =&gt; Exec[&#39;packages_upgrade&#39;],
require =&gt; Exec[&#39;packages_update&#39;],
require =&gt; Package[$packages_native],
require =&gt; Exec[&#39;git_clone&#39;],
require =&gt; Exec[&#39;chown_kitsune&#39;],
require =&gt; Exec[&#39;packages_compiled&#39;],
require =&gt; Exec[&#39;packages_vendor&#39;],
require =&gt; Exec[&#39;db_create&#39;],
require =&gt; Exec[&#39;db_import&#39;],
require =&gt; file[&#39;/etc/supervisor/supervisord.conf&#39;],
require =&gt; Exec[&#39;supervisor_stop&#39;],
</pre></div>
</div>
<p>This roughly translates to the following workflow logic:</p>
<ul class="simple">
<li>Ensure that `aptitude -y update; aptitude -y upgrade` have been run before you try to install the list of packages we require.</li>
<li>Ensure the list of packages we require is installed before we checkout the code.</li>
<li>Ensure the code has been checked out (and pip install / git submodule have been run) before you try to syncdb and run the application.</li>
</ul>
<p>There is a bit more to it, but with that knowledge you should be able to <a class="reference external" href="https://github.com/aclark4life/kitsune-vagrant/blob/master/manifests/kitsune.pp">read and understand kitsune.pp in full</a>. I learned most of the remaining required puppeteering from this site:<a class="reference external" href="http://www.puppetcookbook.com/">http://www.puppetcookbook.com/</a>.</p>
</div>
<div class="section" id="mozilla">
<h2>Mozilla<a class="headerlink" href="#mozilla" title="Permalink to this headline">¶</a></h2>
<p>Oh my! This Mozilla work is a ton of fun[3]; I attribute this in part due to the structure of their organization: I was invited immediately to collaborate in IRC with the kitsune team and as a result, we all have something to show for it[4]. Next I will be working on the 3rd milestone! Hope to finish by the end
of this week.</p>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<p>[1] This did not work on Snow Leopard, because `gem` is too old.  However if you `brew install ruby` and try again, it should work.</p>
<p>[2] I didn&#8217;t bother to investigate Chef, but I am curious about it.</p>
<p>[3] And I hope this is only the beginning.</p>
<p>[4] I hope to get a Mozilla gig but even if I don&#8217;t, being able to do this type of work is very rewarding (which is why you will often hear people in open source say that to get paid for the type of work they do is a dream come true).</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../../../09/22/mozilla-and-pypi/">
    <i class="fa fa-arrow-circle-left"></i>
    Mozilla and PyPI
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../../14/pillow-one-year-later/">
    Pillow: One Year Later
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'aclark-blog';
        var disqus_identifier = '/2011/10/03/vagrant-puppet-and-mozilla-oh-my/';
        var disqus_title = 'Vagrant, Puppet and Mozilla, Oh my';
        var disqus_url = 'http://blog.aclark.net/2011/10/03/vagrant-puppet-and-mozilla-oh-my/';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016, Alex Clark.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>