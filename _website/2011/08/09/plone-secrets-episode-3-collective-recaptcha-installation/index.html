<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Plone Secrets: Episode 3 - Collective Recaptcha Installation &mdash; Alex Clark&#39;s Blog</title>
    
    <link rel="stylesheet" href="../../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootswatch-3.3.4/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="top" title="Alex Clark&#39;s Blog" href="../../../../" />
  
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
  <link rel="alternate" type="application/atom+xml"  href="../../../../blog/atom.xml" title="Alex Clark's Blog">
  
  
  <link href="True" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../">
          Alex Clark&#39;s Blog</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="http://aclark.net">Home</a></li>
                <li><a href="https://www.facebook.com/aclark4life">Facebook</a></li>
                <li><a href="https://github.com/aclark4life">GitHub</a></li>
                <li><a href="https://gratipay.com/aclark4life">Gratipay</a></li>
                <li><a href="https://www.linkedin.com/in/aclark4life">LinkedIn</a></li>
                <li><a href="https://twitter.com/aclark4life">Twitter</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../now/">What I&#8217;m doing now</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../feeds/">Feeds</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../search/" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    Aug 09, 2011
  
  </h2>

  <ul>
    

  

  

  

  
  <li><i class="fa-fw fa fa-folder-open"></i>
    
      
      <a href="../../../../blog/category/buildout/">Buildout</a>,
      
    
      
      <a href="../../../../blog/category/plone/">Plone</a>
      
    </li>
  

  
  
  <li>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'aclark-blog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/2011/08/09/plone-secrets-episode-3-collective-recaptcha-installation/index/"> </a>
  </li>
  
  </ul>



  <h3><a href="../../../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../../../2016/10/26/project-makefile-open-business/">Oct 26 - Project Makefile Open for Business</a></li>
    
      <li><a href="../../../../2016/04/03/yup-this-blog-is-now-powered-by-ablog/">Apr 03 - Yup, this blog is now powered by ABlog</a></li>
    
      <li><a href="../../../../2016/02/21/updated-django-website/">Feb 21 - Updated Django Website</a></li>
    
      <li><a href="../../../../2015/10/10/plock-0-5-0-is-out/">Oct 10 - Plock 0-5-0 is out</a></li>
    
      <li><a href="../../../../2015/10/07/dc-python-jobs/">Oct 07 - DC Python Jobs</a></li>
    
  </ul>

  <h3><a href="../../../../blog/category/">Categories</a></h3>
  <ul>
  
    
    <li><a href="../../../../blog/category/buildout/">Buildout (33)</a></li>
    
  
    
    <li><a href="../../../../blog/category/django/">Django (5)</a></li>
    
  
    
    <li><a href="../../../../blog/category/misc/">Misc (22)</a></li>
    
  
    
    <li><a href="../../../../blog/category/mozilla/">Mozilla (2)</a></li>
    
  
    
    <li><a href="../../../../blog/category/music/">Music (1)</a></li>
    
  
    
    <li><a href="../../../../blog/category/pillow/">Pillow (16)</a></li>
    
  
    
    <li><a href="../../../../blog/category/plone/">Plone (79)</a></li>
    
  
    
    <li><a href="../../../../blog/category/pyramid/">Pyramid (6)</a></li>
    
  
    
    <li><a href="../../../../blog/category/python/">Python (62)</a></li>
    
  
    
    <li><a href="../../../../blog/category/zope/">Zope (6)</a></li>
    
  
  </ul>

  <h3><a href="../../../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../../../blog/2016/">2016 (3)</a></li>
    
  
    
    <li><a href="../../../../blog/2015/">2015 (13)</a></li>
    
  
    
    <li><a href="../../../../blog/2014/">2014 (11)</a></li>
    
  
    
    <li><a href="../../../../blog/2013/">2013 (21)</a></li>
    
  
    
    <li><a href="../../../../blog/2012/">2012 (35)</a></li>
    
  
    
    <li><a href="../../../../blog/2011/">2011 (26)</a></li>
    
  
    
    <li><a href="../../../../blog/2010/">2010 (9)</a></li>
    
  
    
    <li><a href="../../../../blog/2009/">2009 (7)</a></li>
    
  
    
    <li><a href="../../../../blog/2008/">2008 (19)</a></li>
    
  
    
    <li><a href="../../../../blog/2007/">2007 (8)</a></li>
    
  
  </ul>

<form action="../../../../search/" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="plone-secrets-episode-3-collective-recaptcha-installation">
<h1>Plone Secrets: Episode 3 - Collective Recaptcha Installation<a class="headerlink" href="#plone-secrets-episode-3-collective-recaptcha-installation" title="Permalink to this headline">¶</a></h1>
<p><strong>Another one from the: &#8220;wow, this approach is totally and completely non-obvious to beginners&#8221; department.</strong></p>
<div class="section" id="my-kingdom-for-a-custom-contact-form-with-captcha">
<h2>My kingdom for a (custom) contact form (with captcha)<a class="headerlink" href="#my-kingdom-for-a-custom-contact-form-with-captcha" title="Permalink to this headline">¶</a></h2>
<p>I don&#8217;t know if I&#8217;ve made written-mention of this anywhere else, but <a class="reference external" href="http://aclark.net">aclark.net</a>has a new customized <a class="reference external" href="http://aclark.net/contact-info">contact form</a> with captcha. ;-) It is customized via <a class="reference external" href="http://pypi.python.org/pypi/z3c.jbot">z3c.jbot</a> which is an awesome tool (more on that later). This in and of itself is not-so-terribly newsworthy. What is interesting, though, is <em>how</em> this new customized form came to be; and how its features compare to the default contact form.</p>
<p>So here goes: In Plone, we have a page template called <a class="reference external" href="http://svn.plone.org/svn/plone/Products.CMFPlone/trunk/Products/CMFPlone/skins/plone_templates/contact-info.cpt">contact-info.cpt</a>. It&#8217;s not so special (in that it is pretty feature-<em>less</em>, though it will send mail if you ask it to) but it does the job for most folks. And it almost has to, because customizing it is beyond the realm of what <em>anyone</em> would call &#8220;straight forward&#8221; or &#8220;reasonable to expect from TTW customizers, integrators, or even developers&#8221;¹.</p>
<p>Why do I say this?</p>
</div>
<div class="section" id="been-there-done-that-cmfformcontroller">
<h2>Been there, done that: CMFFormController<a class="headerlink" href="#been-there-done-that-cmfformcontroller" title="Permalink to this headline">¶</a></h2>
<p>First, let me start with the technology that is used to implement the contact form.&nbsp;It&#8217;s called <a class="reference external" href="http://pypi.python.org/pypi/Products.CMFFormController">CMFFormController</a> and it went out of style in the 1970s, along with disco and bell bottoms. Bell bottoms came back, but CMFFormController didn&#8217;t! Don&#8217;t get me wrong: CMFFormController is a decent technology/implementation. It works. But it&#8217;s not very &#8220;modern&#8221; by today&#8217;s coding standards. As such, it will simply be dragged along Plone-version-after-Plone-version until either: a.) someone wants to replace it, or b.) it becomes too big of a maintenance burden to support and someone has to replace it. This is the way of many things, and there is nothing inherently wrong with this phenomenon. In fact, there are even good things about it: e.g. the release manager, framework team, and core developers&#8217; ability to publish release-after-solid-release under such code-aging circumstances is a testament to their skill and dedication.</p>
<p>BUT… and this is a BIG BUT.</p>
</div>
<div class="section" id="we-can-do-better">
<h2>We can do better<a class="headerlink" href="#we-can-do-better" title="Permalink to this headline">¶</a></h2>
<p>Leaving this old stuff laying around, with no new stuff to point new users to does a huge disservice to <em>all</em> of our users. It flies <em>directly</em> in the face of one of our core missions: as <a class="reference external" href="https://twitter.com/#!/asigottech">Wyn Williams</a> put it once, to be the</p>
<blockquote>
<div><strong>&#8220;best damn enterprise content manage system on the planet&#8221;.</strong></div></blockquote>
<p>Now, I&#8217;ve been around the block, so I am not suggesting we must fix everything at once. Legacy software can be supported for years and years and years (and <a class="reference external" href="http://pypi.python.org/pypi/Zope2">YEARS</a>). What I am suggesting is that we need to make a very significant effort to <strong>COMPLETELY HIDE</strong> these implementation details to newcomers. I don&#8217;t want to tell people in IRC to go to <strong>portal_skins</strong> anymore. I want my &#8220;OS X Lion release for Plone&#8221;, please (sans Vista overtones.)</p>
<p>So how do we get there? Well, in the case of portal_skins there is talk of decommissioning <strong>portal_view_customizations,</strong> which was supposed to be the &#8220;new portal_skins&#8221; as I understand it. But since half of our templates are still in CMF skin layers, <em>and</em> because this feature was not technically well received (i.e. it needs <em>more</em> features and development), <em>and</em> because <strong>portal_resources</strong> came along around the same time as <a class="reference external" href="http://pypi.python.org/pypi/plone.app.theming">plone.app.theming</a>, folks are considering removing portal_view_customizations. I have no strong opinion about it (other than I hate the name, too long) and I trust the Framework Team to handle it. What I do care about is that whatever remains in the ZMI be very clearly designated as either &#8220;new style&#8221; or &#8220;old style&#8221;. We can&#8217;t get away from the ZMI yet, but portal tools do have title attributes so let&#8217;s use them.</p>
<p>Now, we can&#8217;t ditch <strong>portal_skins</strong> just yet, and who knows what will happen with <strong>portal_view_customizations</strong>, but the *minute* we know some technology is out of date, we should reveal it in the user interface (even in the ZMI user interface). E.g.:</p>
<blockquote>
<div>Curiously, the attribute that holds this string is lowercase &#8220;title&#8221;
(I&#8217;d expect camel case Description, though I&#8217;m not entirely sure why
I expect that.)</div></blockquote>
<p>Hanno Schlichting has made some great progress recently with enhancing the ZMI for Plone users, especially with regard to<em>file-system vs.  through-the-web</em> development, and <em>through-the-plone vs. through-the-zmi configuration</em>.</p>
<p>I love this trend, and would like to see more of it!</p>
</div>
<div class="section" id="secrets-revealed">
<h2>Secrets revealed<a class="headerlink" href="#secrets-revealed" title="Permalink to this headline">¶</a></h2>
<p>Anyway, I&#8217;ve been dancing around the secrets to be revealed in this blog post because it is fun to play with the future. And it&#8217;s important to work hard toward achieving it. But enough of that, here is what you need to know today.</p>
<p>Like I said, I customized the contact form.</p>
</div>
<div class="section" id="old-style-vs-new-style">
<h2>Old style vs. new style<a class="headerlink" href="#old-style-vs-new-style" title="Permalink to this headline">¶</a></h2>
<p>Back in the &#8220;old days&#8221; you had to create a CMF skin layer and put a copy of the template in a directory on the file system, configured as a File System Directory View. <em>Everything</em> used to be customized via skin layers.</p>
<p>Now-a-days, we have z3c.jbot. Though a bit of a hack², it does exactly what you&#8217;d expect, almost exactly how you&#8217;d expect it to. It <a class="reference external" href="https://github.com/aclark4life/aclark_net_website">doesn&#8217;t even require a Python package</a>. By convention though, folks typically do put z3c.jbot template customizations in Python packages.</p>
<p>This requires a few steps.</p>
</div>
<div class="section" id="step-1-create-a-python-package">
<h2>Step 1: Create a Python package<a class="headerlink" href="#step-1-create-a-python-package" title="Permalink to this headline">¶</a></h2>
<p>First, a Python package. This is relatively simple, so I&#8217;m not going to skip-and-point-you-somewhere-else just yet, I&#8217;m going to explain first.
The <a class="reference external" href="https://gist.github.com/1123090">gist of it</a> is this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ mkdir -p my.package/my/package
$ touch my.package/setup.py
$ touch my.package/my/__init__.py
$ touch my.package/my/package/__init__.py
</pre></div>
</div>
<p>Now you would edit setup.py and the &#8220;middle&#8221; __init__.py with code.
Something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>#!/bin/sh
mkdir -p my.package/my/package
touch my.package/setup.py
touch my.package/my/__init__.py
touch my.package/my/package/__init__.py
cat &gt; my.package/setup.py &lt;&lt; EOF
from setuptools import setup, find_packages
setup(
    name=&#39;my.package&#39;,
    packages=find_packages(),
    namespace_packages=[
        &#39;my&#39;,
    ]
)
EOF
cat &gt; my.package/my/__init__.py &lt;&lt; EOF
from pkg_resources import declare_namespace
declare_namespace(__name__)
EOF
</pre></div>
</div>
<p>Alternatively, use <a class="reference external" href="http://pypi.python.org/pypi/ZopeSkel">ZopeSkel</a> to generate all this boilerplate code for you. It does a much better, and more complete job than what I have done here. The important thing is that you <em>understand what is going on</em>. In the case of aclark.net, our Python package is called <a class="reference external" href="https://github.com/ACLARKNET/aclark_net_website/tree/master/src/plonetheme.aclarknet">plonetheme.aclarknet</a>.</p>
</div>
<div class="section" id="step-2-add-template-overrides">
<h2>Step 2: Add template overrides<a class="headerlink" href="#step-2-add-template-overrides" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a Python package we can start customizing Plone. By convention, we&nbsp; create a &#8220;templates&#8221; directory inside the namespaced package e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ mkdir my.package/my/package/templates
</pre></div>
</div>
<p>Or you can check out aclark.net&#8217;s &#8220;templates&#8221; directory here:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ACLARKNET/aclark_net_website/tree/master/src/plonetheme.aclarknet/plonetheme/aclarknet/templates">https://github.com/ACLARKNET/aclark_net_website/tree/master/src/plonetheme.aclarknet/plonetheme/aclarknet/templates</a></li>
</ul>
<p>Because of the way z3c.jbot works, in the &#8220;templates&#8221; directory, we add files with names that correspond to the Python module we want to customize. E.g.</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ACLARKNET/aclark_net_website/blob/master/src/plonetheme.aclarknet/plonetheme/aclarknet/templates/Products.CMFPlone.skins.plone_templates.contact-info.cpt">https://github.com/ACLARKNET/aclark_net_website/blob/master/src/plonetheme.aclarknet/plonetheme/aclarknet/templates/Products.CMFPlone.skins.plone_templates.contact-info.cpt</a></li>
</ul>
<p>(For some reason, github thinks that file is binary, so <a class="reference external" href="http://dpaste.com/589529/">here are the contents</a>.)</p>
<p>Now, this is the amazing part: in addition to templates in views, viewlets and portlets, we can customize any <a class="reference external" href="http://old.zope.org/Products/CMF/">CMF</a> object! E.g. the <a class="reference external" href="http://pypi.python.org/pypi/RestrictedPython">RestrictedPython</a> (more technology anyone?) CMFFormController validation script used to validate our contact form:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ACLARKNET/aclark_net_website/blob/master/src/plonetheme.aclarknet/plonetheme/aclarknet/templates/Products.CMFPlone.skins.plone_form_scripts.validate_site_feedback.vpy">https://github.com/ACLARKNET/aclark_net_website/blob/master/src/plonetheme.aclarknet/plonetheme/aclarknet/templates/Products.CMFPlone.skins.plone_form_scripts.validate_site_feedback.vpy</a></li>
</ul>
<p>That brings us to adding recaptcha, but first let us finish configuring template overrides.</p>
</div>
<div class="section" id="step-3-configure-template-overrides">
<h2>Step 3: Configure template overrides<a class="headerlink" href="#step-3-configure-template-overrides" title="Permalink to this headline">¶</a></h2>
<p>Now that we have customized Plone templates, we can configure Plone to use our customizations.</p>
<p>This is done via a technology you may have heard of: <a class="reference external" href="http://plone.org/documentation/manual/theme-reference/buildingblocks/components/wiring">ZCML</a>. Using ZCML, we can tell Plone (or jbot in this case) to use the templates in our &#8220;templates&#8221; directory.</p>
<p>The ZCML we are going to use is placed in the &#8220;top level&#8221; configure.zcml file in our package. That means we need a top level configure.zcml file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ touch my.package/my/package/configure.zcml
</pre></div>
</div>
<p>Next we add ZCML to &#8220;configure our application&#8221;. Note in addition to the ZCML used to configure jbot, there is ZCML for Diazo and ZCML to hold our <a class="reference external" href="http://blog.aclark.net/2011/06/20/plone-secrets-episode-1-%e2%80%94-site-actions-contact-link/">Genericsetup customizations:</a></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>&lt;configure
    xmlns:browser=&quot;http://namespaces.zope.org/browser&quot;
    xmlns:genericsetup=&quot;http://namespaces.zope.org/genericsetup&quot;
    xmlns:plone=&quot;http://namespaces.plone.org/plone&quot;
    xmlns=&quot;http://namespaces.zope.org/zope&quot;&gt;    &lt;plone:static directory=&quot;theme/aclarknet&quot; type=&quot;theme&quot; /&gt;    &lt;include package=&quot;z3c.jbot&quot; file=&quot;meta.zcml&quot; /&gt;
    &lt;browser:jbot directory=&quot;templates&quot; /&gt;    &lt;genericsetup:registerProfile
        name=&quot;default&quot;
        title=&quot;ACLARK.NET, LLC profile&quot;
        description=&quot;Installs ACLARK.NET, LLC site
            customizations&quot;
        directory=&quot;profiles/default&quot;
        provides=&quot;Products.GenericSetup.interfaces.EXTENSION&quot;
        /&gt;&lt;/configure&gt;
</pre></div>
</div>
<p>This file is located here:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ACLARKNET/aclark_net_website/blob/master/src/plonetheme.aclarknet/plonetheme/aclarknet/configure.zcml">https://github.com/ACLARKNET/aclark_net_website/blob/master/src/plonetheme.aclarknet/plonetheme/aclarknet/configure.zcml</a></li>
</ul>
<p>You can see that everything inside the &lt;configure&gt;&lt;/configure&gt; tag(s) is associated with an XML namespace. If you don&#8217;t add the appropriate namespace inside the &lt;configure&gt; tag, your configuration will fail spectacularly (because without the proper XML namespace configured, there is no code loaded to handle your configuration.)</p>
</div>
<div class="section" id="step-4-add-recaptcha">
<h2>Step 4: Add recaptcha<a class="headerlink" href="#step-4-add-recaptcha" title="Permalink to this headline">¶</a></h2>
<p>Now, finally, we get to the exciting part. We have customized our contact form, but we are receiving a fair amount of spam due to spammers&#8217; ability to automate form submission. To foil the spammers, we want to add a captcha form that will hopefully require that an actual human to fill out the form.</p>
<p>Thanks to David Glick and Groundwire, we have <a class="reference external" href="http://pypi.python.org/pypi/collective.recaptcha">collective.recaptcha</a> which provides an integration of <a class="reference external" href="http://www.google.com/recaptcha">Google&#8217;s Recaptcha service</a> into Plone.</p>
<p>In order to use it, first we add the package to our buildout, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>…
[plone]
# Eggs are Python packages
eggs +=
#   Diazo theming
    plonetheme.aclarknet
#   Add-ons
    collective.portlet.wordpress
    collective.recaptcha# Need zcml for c.recaptcha until 1.1.3 is released
zcml = collective.recaptcha
…
</pre></div>
</div>
<p>See the rest of the file here:</p>
<ul class="simple">
<li><a class="reference external" href="https://raw.github.com/ACLARKNET/aclark_net_website/master/buildout.cfg">https://raw.github.com/ACLARKNET/aclark_net_website/master/buildout.cfg</a></li>
</ul>
<p>Now run buildout and restart Plone.</p>
<p>With collective.recaptcha installed via buildout, you should now be able to open <a class="reference external" href="http://yoursite:8080/Plone/&#64;&#64;recaptcha-settings">http://yoursite:8080/Plone/&#64;&#64;recaptcha-settings</a> to configure Recaptcha.</p>
<p>(To get a public and private key, you can sign up for recaptcha here: <a class="reference external" href="http://www.google.com/recaptcha">http://www.google.com/recaptcha</a>)</p>
<p>Lastly, make the appropriate changes to the contact form and validation script. E.g. <a class="reference external" href="http://dpaste.com/589529/">include the captcha image:</a></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>…
&lt;tal:block tal:replace=&quot;structure
    context/@@captcha/image_tag&quot;/&gt;
…
</pre></div>
</div>
<p>And make sure to <a class="reference external" href="https://github.com/ACLARKNET/aclark_net_website/blob/master/src/plonetheme.aclarknet/plonetheme/aclarknet/templates/Products.CMFPlone.skins.plone_form_scripts.validate_site_feedback.vpy">validate the submission</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>…
    # Re-captcha validation
    if not context.restrictedTraverse(&#39;@@captcha&#39;).verify():
        context.plone_utils.addPortalMessage(_(u&#39;You entered
            an invalid captcha.&#39;), &#39;error&#39;)
        return state.set(status=&#39;failure&#39;)
    else:
        return state
…
</pre></div>
</div>
<p>That&#8217;s it!</p>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<p>¹ I&#8217;m pushing &#8220;reasonable&#8221; limits here for argument&#8217;s sake. For those who know Plone already, a lot of what might seem impossible to newcomers is &#8220;reasonable&#8221; for them. No flames please. Unless you absolutely must.  ;-)</p>
<p>² I hear people call it that, though I don&#8217;t know the details. I assume it &#8220;monkey patches&#8221; which template to use at render-time.</p>
</div>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../../../07/06/plone-secrets-episode-2-collective-python-buildout/">
    <i class="fa fa-arrow-circle-left"></i>
    Plone Secrets: Episode 2 - Collective Python Buildout
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../../20/hello-plone/">
    Hello Plone
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'aclark-blog';
        var disqus_identifier = '/2011/08/09/plone-secrets-episode-3-collective-recaptcha-installation/';
        var disqus_title = 'Plone Secrets: Episode 3 - Collective Recaptcha Installation';
        var disqus_url = 'http://blog.aclark.net/2011/08/09/plone-secrets-episode-3-collective-recaptcha-installation/';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016, Alex Clark.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>